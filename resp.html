<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Booking Response</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      background-color: #1c1c1c;
      color: white;
      padding: 40px;
      font-family: 'Segoe UI', sans-serif;
    }

    .response-box {
      background-color: rgba(0, 0, 0, 0.75);
      padding: 30px;
      border-radius: 12px;
      max-width: 700px;
      margin: auto;
    }

    h1, h2 {
      color: #00d0ff;
      text-align: center;
    }

    p span {
      font-weight: bold;
      color: #ffc107;
    }

    .btn-home {
      display: block;
      margin: 20px auto 0;
      background-color: #28a745;
      color: white;
      padding: 10px 25px;
      border: none;
      border-radius: 5px;
      text-decoration: none;
      text-align: center;
    }

    .btn-download {
      display: block;
      margin: 20px auto;
      background-color: #007bff;
      color: white;
      padding: 10px 25px;
      border: none;
      border-radius: 5px;
      text-decoration: none;
      text-align: center;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="response-box" id="bookingDetailsBox">
    <h1>üöò CAR RENTAL</h1><br><br>
    <h1>‚úÖ Booking Confirmation</h1><br>

    <h2 class="mt-4">üë§ User Information</h2><br><br>
    <p>Full Name: <span id="userName"></span></p>
    <p>Email: <span id="userEmail"></span></p>
    <p>Phone: <span id="userPhone"></span></p><br>

    <hr><br>

    <h2 class="mt-4">üìç Booking Details</h2><br>
    <p>City: <span id="bookingCity"></span></p>
    <p>Location: <span id="bookingLocation"></span></p>
    <p>Start Date: <span id="bookingStart"></span></p>
    <p>End Date: <span id="bookingEnd"></span></p><br>

    <h2>üöó Booking Confirmation</h2><br>
    <div id="carDetails"></div><br>

    <button class="btn-download" id="downloadPdfBtn">‚¨áÔ∏è Download as PDF</button>
    <a href="home1.html" class="btn-home">üîô Back to Home</a>
  </div>

  <script>
    const user = JSON.parse(localStorage.getItem("userAccount"));
    const booking = JSON.parse(localStorage.getItem("bookingDetails"));
    const carData = JSON.parse(localStorage.getItem('selectedCar'));
    
    document.getElementById("userName").textContent = user?.fullName || "N/A";
    document.getElementById("userEmail").textContent = user?.email || "N/A";
    document.getElementById("userPhone").textContent = user?.phone || "N/A";

    document.getElementById("bookingCity").textContent = booking?.city || "N/A";
    document.getElementById("bookingLocation").textContent = booking?.location || "N/A";
    document.getElementById("bookingStart").textContent = booking?.startDate || "N/A";
    document.getElementById("bookingEnd").textContent = booking?.endDate || "N/A";

    if (carData) {
      document.getElementById('carDetails').innerHTML = `
        <h3>${carData.name}</h3>
        <img src="${carData.image}" alt="${carData.name}" width="200">
        <p><strong>Price per day:</strong> ${carData.price}</p>
      `;
    } else {
      document.getElementById('carDetails').innerText = "No car selected.";
    }
    document.getElementById("downloadPdfBtn").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFont("helvetica", "bold");
      doc.setFontSize(18);
      doc.text("Booking Confirmation", 60, 20);

      doc.setFontSize(12);
      doc.setFont("helvetica", "normal");

      doc.text("User Information:", 20, 40);
      doc.text(`Full Name: ${user?.fullName || "N/A"}`, 30, 50);
      doc.text(`Email: ${user?.email || "N/A"}`, 30, 60);
      doc.text(`Phone: ${user?.phone || "N/A"}`, 30, 70);

      doc.text("Booking Details:", 20, 90);
      doc.text(`City: ${booking?.city || "N/A"}`, 30, 100);
      doc.text(`Location: ${booking?.location || "N/A"}`, 30, 110);
      doc.text(`Start Date: ${booking?.startDate || "N/A"}`, 30, 120);
      doc.text(`End Date: ${booking?.endDate || "N/A"}`, 30, 130);

      if (carData) {
        doc.text("Car Details:", 20, 150);
        doc.text(`Name: ${carData.name}`, 30, 160);
        doc.text(`Price per day: ${carData.price}`, 30, 170);

        const img = new Image();
        img.src = carData.image;
        img.crossOrigin = "anonymous"; 
        img.onload = function() {
          doc.addImage(img, 'JPEG', 30, 180, 150, 90);
          doc.save("booking_confirmation.pdf");
        };
        img.onerror = function() {
          alert("Failed to load car image. PDF will be saved without image.");
          doc.save("booking_confirmation.pdf");
        };
      } else {
        doc.text("No car selected.", 30, 150);
        doc.save("booking_confirmation.pdf");
      }
    });
  </script>

</body>
</html>
